<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=content-language content="en-US"><title>Physics engine design | Olivia's blog</title><script src=https://code.jquery.com/jquery-3.6.0.min.js></script>
<script src=https://unpkg.com/browse/mermaid@8.8.0/dist/mermaid.min.js></script>
<link rel=stylesheet type=text/css href=https://lunarwatcher.github.io/scss/style.min.css><link rel=alternate type=application/rss+xml title="Olivia's blog" href=https://lunarwatcher.github.io/blog/feed.xml><meta property="og:title" content="Physics engine design"><meta property="og:url" content="https://lunarwatcher.github.io/newsletter.html"></head><body><header><nav class=nav-container><div class=container><h1 class="logo left"><a href=/>Olivia</a></h1><div id=sidenav class=sidenav><a href=javascript:void(0) class=close onclick=closeSidenav()>&#215;</a>
<a href=/>Home</a>
<a href=/posts/>Blog</a>
<a href=/tags.html>Tags</a>
<a href=/notes/>Notes</a>
<a href=/emojis.html>Emoji reference</a></div><div class="topnav right"><a href=/>Home</a>
<a href=/posts/>Blog</a>
<a href=/tags.html>Tags</a>
<a href=/notes/>Notes</a>
<a href=/emojis.html>Emoji reference</a></div><span class=sidenav-trigger onclick=openSidenav()>&#9776;</span></div></nav></header><main><div class=container id=content><h1>Physics engine design</h1><span class=post-meta>Posted on July 5th, 2021</span>
<span class=post-meta>Tags:
<a class=post-tag href=https://lunarwatcher.github.io/tags/physics.html>#physics</a></span><br><p><em>(primarly written <a href=https://github.com/LunarWatcher/Genesis>for an existing project</a>)</em></p><p>The main problem with integrating a physics engine architecture on top of the existing planned AI architecture is that they're separate, but still have overlap.</p><p>Optimally, the physics engine needs to track all the entities, and the AI controllers track a subset. This difference is unfortunately why things get hard.</p><p>Each AI controller can get away with a linear container, where the physics engine also need to store its controlled entities in a tree-like data structure, primarily to optimize for click events. The entity controllers themselves can also take advantage of a tree-like structure, to tell what not to render. This essentially establishes the following structure:</p><div class=mermaid align=center>classDiagram
class PhysicsEngine{
+std::vector~PhysicsController~
}
class PhysicsController {
+Container~Entities~
+tick()
}
class EntityController {
+tick()
+render()
}
PhysicsEngine --> ControllerImpl : contains
PhysicsController &lt;|-- ControllerImpl : extends
EntityController &lt;|-- ControllerImpl : extends - only necessary for AI</div><p>Note that ControllerImpl is any class that implements PhysicsController and optionally EntityController - it's not a real class, but a representation of any number of classes.</p><p>The immediate downside to this approach is that it doesn't fully optimize the controllers for layers - notably, all the entities are stored by their respective EntityController, as opposed to all entities in that layer being associated to a PhysicsController.</p><p>While that is a viable design choice, it creates two places where entities need to be managed, which means in cases where entities are added or removed, they need to be added or removed in two places, causing unnecessary work.</p><p>The entire implementation may be backwards, though. If that's the case, that stems from various other design choices in this specific project.</p><p>Most proper, dedicated physics engines with substantially more physics features than what this one needs seem to use static methods for creating pointers, that're manually destroyed, presumably in the destructor or when the physics aspects cease to exist.</p><p>Might've been a lot easier if the physical attributes were connected to a PhysicsObject instead of an entity, which would've simplified this clusterfuck:</p><div class=mermaid align=center>classDiagram
class Entity {
+std::shared_ptr~Collider~
}
class Collider {
&lt;&lt;Super-class for collider shapes>>
+collidesWith(const Rectangle& rect)
    +collidesWith(...) : Future
}
Entity --> Collider : Contains
PhysicsController --> Collider : Manages and checks for collisions
PhysicsEngine "1" --> "n" PhysicsController : Manages controllers and does logical collision checks
PhysicsController "1" --> "n" Entity : Contains</div><p>PhysicsController itself deals with the actual physics for its entities, though there's not that many at the time of writing aside collision. Implementing the raw physics processing things in a super-class prevents reimplementation for each physics controller, though the physics API has to be implemented in a way that allows varying physics for varying types of entities. Gravity isn't particularly a problem in this type of game, but it should be compatible if it's needed.</p><div class=comments><hr><h2 style=padding-top:20px!important>Comments</h2><i><p>All comments posted either through utteranc.es or manually on the associated GitHub issue end up on an associated issue in the <a href=https://github.com/LunarWatcher/lunarwatcher.github.io>website GitHub repo</a>, and as such are required to follow the <a href=https://github.com/LunarWatcher/lunarwatcher.github.io/blob/master/.github/CODE_OF_CONDUCT.md>project code of conduct</a>. Remember this while writing comments.</p></i><script src=https://utteranc.es/client.js repo=LunarWatcher/lunarwatcher.github.io issue-term=pathname label=comments theme=github-light crossorigin=anonymous async></script><noscript>You've disabled JavaScript, which the comment system makes use of to load them on the site. The comment threads can be found <a href=https://github.com/LunarWatcher/lunarwatcher.github.io/issues>in the issues for this repo</a>, if you don't trust this site and/or utterances. Note that unless someone has already commented, there isn't an issue made for this page yet.</noscript></div></div></main><footer class=page-footer><div class=footer-copyright><div class=container style=overflow:auto>&copy; Olivia, 2019-2021
(<a href=https://github.com/LunarWatcher/LunarWatcher.github.io/tree/master>Website source</a>, <a href=https://github.com/LunarWatcher/lunarwatcher.github.io/blob/master/LICENSE>license</a>)<p class=right>Powered by <a href=https://gohugo.io/>Hugo</a>
(<a href=javascript:uwu() id=uwu>UwU?</a>)</p></div></div></footer><script type=text/javascript src=https://lunarwatcher.github.io/js/functions.min.js></script></body></html>