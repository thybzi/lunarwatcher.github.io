<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=content-language content="en-US"><title>My notes on Neovim | Olivia's blog</title><script src=https://code.jquery.com/jquery-3.6.0.min.js></script>
<link rel=stylesheet type=text/css href=https://lunarwatcher.github.io/scss/style.min.css><link rel=alternate type=application/rss+xml title="Olivia's blog" href=https://lunarwatcher.github.io/blog/feed.xml><meta property="og:title" content="My notes on Neovim"><meta property="og:url" content="https://lunarwatcher.github.io/newsletter.html"></head><body><header><nav class=nav-container><div class=container><h1 class="logo left"><a href=/>Olivia</a></h1><div id=sidenav class=sidenav><a href=javascript:void(0) class=close onclick=closeSidenav()>&#215;</a>
<a href=/>Home</a>
<a href=/posts/>Blog</a>
<a href=/tags.html>Tags</a>
<a href=/notes/>Notes</a>
<a href=/emojis.html>Emoji reference</a></div><div class="topnav right"><a href=/>Home</a>
<a href=/posts/>Blog</a>
<a href=/tags.html>Tags</a>
<a href=/notes/>Notes</a>
<a href=/emojis.html>Emoji reference</a></div><span class=sidenav-trigger onclick=openSidenav()>&#9776;</span></div></nav></header><main><div class=container id=content><h1>My notes on Neovim</h1><span class=post-meta>Posted on March 7th, 2021</span>
<span class=post-meta>Tags:
<a class=post-tag href=https://lunarwatcher.github.io/tags/editor.html>#editor</a>, <a class=post-tag href=https://lunarwatcher.github.io/tags/vim.html>#vim</a>, <a class=post-tag href=https://lunarwatcher.github.io/tags/neovim.html>#neovim</a></span><br><p>So I decided to give Neovim another try (and specifically nvim-qt). Here's what happened. <sub>Note that I'm not looking for a "solution to my problem" or any crap like that. This is purely based on my observations and experience with Neovim.</sub></p><p>Also, obligatory disclaimer that this ended up being a stream of consciousness, and may therefore lack a bit of structure.</p><hr><p>I decided to give Neovim a try after reading up on Vim 9, specifically surrounding compatibility with neovim. I went to the <a href=https://github.com/vim/vim/blob/master/README_VIM9.md>Vim9 README</a> for the performance stats as well (purely for the pointless trivia). This is largely because I'm diving deeper into the realm of plugin development (I have no idea why). This was largely while looking into which language to use for a plugin, for stdlib availability. There's bits I don't feel like reimplementing for the plugin I was looking into. I also got side-tracked into performance stats, because I do that some times.</p><p>The relevant bit of the Vim9 README is the second point: deprioritizing interfaces.</p><p>I initially misunderstood the point behind it until I started writing this post, actually. Anyway, that spiraled down into <a href=https://old.reddit.com/r/vim/comments/ey91bd/i_have_mixed_feelings_for_vim9_script_what_do_you/fggezgd/>reddit</a>, <a href=https://old.reddit.com/r/vim/comments/ebz0cj/vim_9/>more reddit</a>, and <a href=https://old.reddit.com/r/neovim/comments/h8perv/will_neovim_merge_vim_9s_upcoming_vimscript/>vim9 compatibility with neovim</a>. A few of these arguments resonated with me (although I'll get back to these later), and I decided to once again try neovim.</p><hr><p>My general workflow for dotfiles <a href=https://github.com/LunarWatcher/dotfiles/blob/master/Makefile>relies on makefiles</a>: I make a new target, throw in whatever I need, run it, and call it a day. At the time of writing, I started 6 hours ago, and abandoned it about 2.5 hours ago. I got tons of obscure build errors, and tried workarounds that didn't work. It took me longer than necessary to realize that I cannot build a few of the third party depndencies by invoking make from make, if that <em>make</em>s sense.</p><p>I broke up the entire command into building third party deps, and it worked from the terminal. Had to split off neovim compilation into a .sh file for it to work. (<strong>compat 1</strong> - these will make sense later).</p><p>Why it failed to compile beats me, but I rework it into a shell file and it somehow magically works. You might ask why I went to compile it in the first place, but that's because I couldn't find any PPAs doing up to date nightly builds, and because I like to keep my editor up to date. That's why I also compile vim from scratch, something I will get back to.</p><p>So I run nvim after linking up a standard .init linking back to my .vimrc, and this is where the real "fun" begins.</p><p>At least with my colorscheme, any errors during startup are hidden (<strong>annoyance 1</strong>). That means I have to manually run <code>:messages</code> after booting to see what went wrong. My font is considered invalid. To be more specific, the font that's valid in vim, gvim, and nvim is invalid in nvim-qt (<strong>compat 2</strong>). Okay, so I look through the docs, find the right format, plug it in, and we're good.</p><p>Then there's the GUI tabline... It has to be disabled with <code>:GuiTabline 0</code>, a command that's only a part of nvim-qt. For those of you who aren't familiar with nvim, nvim presents one of its major advantages being the separation of UI and backend, with the end goal of being able to embed nvim literally anywhere instead of adding some cheap vim emulation crap like other editors and websites (overleaf, anyone?) have. Sounds promising, right? Especially for someone like me, who uses a GUI to get around terminal input processing issues? <strong>Wrong.</strong></p><p>The secondary implication of this is that <code>init.vim</code> (or <code>.vimrc</code> in my case, which I'll refer the init file as from this point) is <em>only sourced for nvim</em>. <code>nvim</code> itself is never a GUI in the gvim/nvim-qt sense of the word. By extension, this also means <code>has("gui_running")</code> is always false, and would never work even if it was a thing. Again, when the <code>.vimrc</code> is sourced, it's <em>always</em> false, because the GUI (that's nvim-qt in my case) attaches <code>nvim</code> itself after the fact. This is by no means an unknown issue (<a href=https://github.com/equalsraf/neovim-qt/issues/94>#94</a>, <a href=https://github.com/equalsraf/neovim-qt/issues/102>#102</a>, <a href=https://github.com/equalsraf/neovim-qt/issues/182>#182</a>, <a href=https://github.com/equalsraf/neovim-qt/issues/213>#213</a>, as well as issues addressing general GUI options).</p><p>Simply (and bluntly put), neovim is incapable of detecting a GUI during startup (<strong>compat 3</strong>). For me, this is a necessity - I use several maps that aren't possible in a terminal. These issues have existed for several years and aren't addressed. Autocmds and terminal aliases injecting variables are the only ways it's allowed to work. <code>$TERM</code> can be empty if and only if neovim is started from the start menu - not from a terminal. On one of the issues that I may have lost track of, someone suggested checking <code>&term</code>, as it's always equal to <code>nvim</code> in nvim-qt. That's wrong. It's always nvim in the <code>.vimrc</code> as well, meaning it's useless for detecting UI or not.</p><p>That also leaves me, someone who randomly decided to switch to nvim for no real reason aside being midly pissed at vim, unable to get nvim working properly without a shitton of if-else statements, weak checks looking for a GUI, and the only option presented is to use a <code>ginit.vim</code> (init file for GUIs). In order to do that, I'd have to fragment my <a href=https://github.com/LunarWatcher/dotfiles/blob/master/.vimrc>clusterfuck of a <code>.vimrc</code></a> heavily, which would take a substantial amount of time when I also want to maintain compatibility with gvim if I decide to jump back (which I already have).</p><p>I fight through a few of these issues, and somehow manage to get all the meta issues out of the way. Coc.nvim worked in the .vim files, stuff loads (although a bit glitchy because of the GuiTabline removal. <strong>annoyance 2</strong>), and I give it a try on a C++ project I have laying around that's largely for vim testing at this point.</p><p>And coc.nvim doesn't work.</p><p>While writing this bit, I randomly figured out why. Neovim's config location relocated <code>coc-settings.json</code>. None of my config was carried over, disabling the two C++ language servers I have hooked up (<strong>annoyance 3</strong>, <strong>compat 4</strong>). Coc.nvim itself gave no notice of this, and I didn't think to imagine that the config was empty all of the sudden. The extensions showed up as installed. One might argue that this is coc.nvim's fault rather than neovim (hell, it's <a href=https://github.com/neoclide/coc.nvim/issues/2841>even an issue</a>), but its config location (and difference between operating systems) has always been a massive pain in the ass. One of the things Vim has done right is config locations - I know <code>~/.vimrc</code> is guaranteed to work on both the operating systems I might find myself on (Linux and Windows), and I don't need to go hunting for the actual config location.</p><p>After I got everything up and running, I tried installing and running TreeSitter with C++, and it was honestly disappointing. It highlighted a single variable while I was typing, but it didn't get close to the screenshots in the nvim treesitter repo.</p><hr><p>There's dozens of migration problems I can list, such as the lack of GUI variables, general pain in the ass configuration, and the annoyance that needing to separate certain bits of config presents for someone like me, with a shitton of intricate editor config. When everything was running, neovim just felt like vim with slightly longer characters for separators, a bit more responsive UI when updating vim plugins, and a somewhat less buggy completion popup (but a substantially uglier one). I have highlighted a few bits of this post with compat and annoyance. These are core issues in migration and/or documentation as a direct part of nvim, or as a side-effect of nvim.</p><p>Why did I bother trying in the first place, though? I mentioned earlier that a few of the arguments did resonate with me, and they're completely correct. Vim has added a lot of hackish implementations with an unnecessary amount of extra implementation work. One of the second arguments here was that it wasn't done in a way that was compatible with nvim, but to be honest, nvim is so incompatible with vim that the argument of introducing incompatibility falls equally much in their court as it does in that of Vim. At the same time, the general motivation behind the arguments <a href=https://old.reddit.com/r/vim/comments/ey91bd/i_have_mixed_feelings_for_vim9_script_what_do_you/fghqnwi/>were countered</a>.</p><p>Vim itself doesn't need to be compatible with neovim's implementations either. Neovim already goes out of its way to do several incompatible changes without trying to make changes in a way that can be merged back into vim, so they're not in any way in a "better" position. That alone to a certain degree proves a point I'm trying to make, and that I noticed in this entire mess: neovim and vim aren't compatible. The projects have fundamentally different reasons for dragging development in whatever direction it ends up in, meaning that over time, they will inevitably be truly incompatible. As proven in this post, neovim is by no means a drop-in replacement for vim, as they claim on their website. They might've been at one point, but that's definitely not the case anymore. What the "final straw" will be to properly prove that they're incompatible, however, is a different story. Might be Vim9, might be the loss of language interfaces, might be a disagreement over lua or a GUI feature, or some bridge they haven't built, and much less crossed, yet. At this time, guessing what could be the cause for a complete split would be just that - guessing.</p><p>There's already a noticable divide in terms of compatibility. Neovim has at least one option (<code>guifont</code>) that's incompatible with itself. "Wait, what?", you're probably asking. "How can it be incompatible with itself?" -- the honest answer is, I have no clue. Might be a qt/gtk/X11/other UNIX weirdness thing, but with no options to detect whether or not nvim is booting with a specific UI, the only option is overriding in ginit. That again assumes guitfont doesn't instantly trigger an error, because if it does, overriding would still cause an error. Compat 3 mentions the inability to properly detect a GUI launch, and the consequences this has for me.</p><p>Compat 1 (and I wish I could add links to that, but Hugo's markdown engine doesn't support it at this time) is one of the weirdest bugs I have seen in general. As as side-effect, neovim goes straight in with a workflow-altering change. Even if I don't use the bundled dependencies, I can't build simply because it excludes dependencies from the explicit list that I don't know how to install. Vim's installation <a href=https://github.com/LunarWatcher/dotfiles/blob/5758b92a89ed9b82a295bed45f37f991fdab0c91/Makefile#L97-L111>isn't pretty</a>, and is arguably one of the most unnecessarily complex commands I've seen, but it at least works on my system regardless of the call context.</p><p>Annoyance 2 covers weird GUI behavior. While I have to admit a few of the GUI implementations look nice (gvim out of the box is horribly ugly), they're not nearly as practical as gvim. I get the same input processing capabilities, but I have no way to detect whether or not I have those input processing capabilities. That presents several challenges, and just presents a few additional compatibilitiy issues (compat 3): GUI load is decoupled from nvim load, presenting a sudden code fragmentation, at least in my case.</p><p>Neovim claims to be a drop-in replacement for Vim, being fully compatible and all that, but somewhat interestingly, Vim is able to maintain compatibility with vi better than neovim is at maintaining compatibility with vim, completely disregarding delays between patches in the two projects (considering they're both active - we have to be reasonable too). It might've been at one point, but as pointed out in <a href=https://old.reddit.com/r/vim/comments/ey91bd/i_have_mixed_feelings_for_vim9_script_what_do_you/fghqnwi/>the fourth reddit link</a>, neovim and vim are diverging, and will continue down that path. In the meanwhile, I hope they drive the development of each other forward. Of course, the question of "who brought the idea" seems to be a driving force in Neovim's rising popularity. This is potentially an extremely unpopular opinion among neovim users, but if Neovim indeed was sparked by a bad PR and that async was planned on a "when a good PR shows up"-basis, that does mean neovim didn't bring all these ideas to the table, but potentially accelerated their implementation. That's still good from a user's perspective</p><p>This is actually my third attempt at neovim (the second one actually entering neovim and messing with config; the second attempt overall was one with more failed compilation), and the first one was on Windows. The clipboard in nvim-qt was broken and was the reason I bailed on it. From some comments <a href=https://geoff.greer.fm/2015/01/15/why-neovim-is-better-than-vim/>on this post</a>, it's abundantly clear that there's several things that've been rejected from Vim over a lack of Windows compatibility, at least where it's expected to be compatible. The <a href=https://old.reddit.com/r/vim/comments/ey91bd/i_have_mixed_feelings_for_vim9_script_what_do_you/fghqnwi/>alleged start of neovim</a> was actually triggered by an incompatible PR.</p><p>Repetitions of how Vim's code is horrible are one of the arguments that've also made me stay away from neovim. Sure, it has horrible bits, but it's 30 years old this year, and has had to use systems that were big back then, but aren't now. Vim necessarily has to update itself, and just from the blog post I linked, it's noticable that change is happening. It mentions <code>eval.c</code> clocking in at 25k lines of code - it's currently down to 6000. And hey, it still works on all the operating systems I want it to work on, so I consider that a win.</p><p>And just to be abundantly clear here, I'm not saying that everything about nvim is wrong or horrible. There are good parts of neovim, but the primary selling points for me have been adopted into vim, making the differences between the two fairly small in some areas. There's the seemingly small things that just build up over time that makes it a bad option for me. A few system compatibility issues also make it substantially less attractive for me - I like using one editor that works on any computer I'm on. That's interestingly not a description that fits Neovim.</p><p>... nor does it entirely fit Vim. Vim is substantially faster on Linux than Windows for an instance, largely due to internal mechanics of process spawning.</p><p>I'm also not saying Vim does everything perfectly. It most definitely has its flaws, both in the processes surrounding Vim, as well as in the editor itself. Not to forget the code, but at the end of the day, I'll still stick with the editor that gives me the least amount of a headache - and that's Vim. I really do hope Vim influences Neovim and vice versa, though. Competition often helps bring out the best in editors, and Vim has historically not had that many direct competitors.</p><p>In the meanwhile, I'll go back to Vim and make it better for my use.</p><hr><h1 id=tldr>TL;DR:</h1><ul><li>Refuses to compile if the compile is initiated from a Makefile (even if the normal command line build is fine)</li><li>GUIs being detached means the vimrc has to be split up to work (not as bad for new .vimrcs, a royal fucking pain in the ass for existing ones, and horrible from a compatibility perspective)</li><li>One of nvim's goals (detaching GUI from vim) effectively breaks certain backwards compatibility aspects</li><li>Certain nvim options are incompatible with nvim-qt (notably <code>set guifont</code>, which takes two different argument styles in nvim and nvim-qt). The secondary implication of this, without GUI detection, is additionally that there's no good way to set the font if GUIs and TUIs are incompatible with each other.</li><li>Several plugins use incompatible config locations, on top of nvim already using incompatible config locations (which again are incompatible between operating systems)</li><li>Neovim is no longer compatible with Vim to the extent one can call it a "drop-in replacement"</li><li>Neovim, from a user perspective, struggles to maintain consistency between platforms in functionality (ref. clipboards) and basic things like config (specifically config locations, as indirectly mentioned in a previous point in this TL;DR:).</li></ul><div class=comments><hr><h2 style=padding-top:20px!important>Comments</h2><i><p>All comments posted either through utteranc.es or manually on the associated GitHub issue end up on an associated issue in the <a href=https://github.com/LunarWatcher/lunarwatcher.github.io>website GitHub repo</a>, and as such are required to follow the <a href=https://github.com/LunarWatcher/lunarwatcher.github.io/blob/master/.github/CODE_OF_CONDUCT.md>project code of conduct</a>. Remember this while writing comments.</p></i><script src=https://utteranc.es/client.js repo=LunarWatcher/lunarwatcher.github.io issue-term=pathname label=comments theme=github-light crossorigin=anonymous async></script><noscript>You've disabled JavaScript, which the comment system makes use of to load them on the site. The comment threads can be found <a href=https://github.com/LunarWatcher/lunarwatcher.github.io/issues>in the issues for this repo</a>, if you don't trust this site and/or utterances. Note that unless someone has already commented, there isn't an issue made for this page yet.</noscript></div></div></main><footer class=page-footer><div class=footer-copyright><div class=container style=overflow:auto>&copy; Olivia, 2019-2021
(<a href=https://github.com/LunarWatcher/LunarWatcher.github.io/tree/master>Website source</a>, <a href=https://github.com/LunarWatcher/lunarwatcher.github.io/blob/master/LICENSE>license</a>)<p class=right>Powered by <a href=https://gohugo.io/>Hugo</a>
(<a href=javascript:uwu() id=uwu>UwU?</a>)</p></div></div></footer><script type=text/javascript src=https://lunarwatcher.github.io/js/functions.min.js></script></body></html>